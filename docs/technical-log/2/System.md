# 操作系统：数字世界的隐形指挥家<Badge type="warning" text="主线3/3" />
::: tip :tada:
Coming Soon~!
:::

如果你读到了这里，说明你已经了解了[编程语言](./Program.md)中的主要内容。接下来我们将进入到编程语言的主要技术产物--操作系统中。

前面我们了解到，编程语言的演进过程，本质上是对底层硬件操作的不断剥离和向上抽象，但剥离出的硬件操作并不是不需要了，而是形成了一个个通用的程序文件。当科学家们将这些程序文件整理成一个合集时，就出现了我们所说的**操作系统（Operating System）** 。其目的是为了构建可快速获取的、可重用的、通用的底层硬件操作能力。

下面的内容将分为4个部分，从不同角度介绍操作系统。
![操作系统介绍流程](./images/process.png)

## 初识：操作系统的千面人生
当说起"操作系统"时，可能想到的是电脑里的Windows或手机里的Android。但事实上，这个星球上正在运行的操作系统远超你的想象：

- **WiFi管家**：OpenWrt系统在路由器默默管理设备网络连接。
- **太空快递员**：SpaceX火箭借定制Linux系统精准操控42台发动机协同工作。
- **生命守护者**：医院呼吸机的VxWorks系统以毫秒级响应保障患者呼吸。
- **未来交通中枢**：特斯拉车机系统同时处理8个摄像头实时数据流。   

这些形态各异的操作系统，本质都是**硬件与软件之间的智能翻译官**。就像联合国同声传译既要听懂各国语言，又要用目标语言精准表达，操作系统需要：  
1. 理解CPU/内存/硬盘等硬件的"机器方言"。  
2. 将这些方言翻译成开发者能理解的、统一的"编程语言"。  
3. 保证所有程序和谐共处不打架。  

::: tip
不同的领域会有不同的操作系统，他们的形态、体积和使用方式都不尽相同。这些操作系统本质上都是对这个领域中的问题在使用计算的方式解决时需要用到的能力封装。有意思的是，这些领域并不是完全隔绝的，就像我们打开电脑时，BIOS引导Windows系统启动，此二者属于两个专业领域，所以可以看做是两个操作系统。
:::

::: details 碎片关键词
* 主板操作系统BIOS
:::


## 解剖：7个操作系统功能模块

结合上文所述，我们知道了操作系统是一堆快速可重用的通用能力程序合集。而要想做到这些特性，就需要一个统一的标准。
值得注意的是，这个标准并不是有一个组织统一定义出来的，而是在计算机的演进过程中不断总结出来的（从实践中来到实践中去）。
目前主流操作系统均包含了以下7个功能模块：

### 1. **进程管理 (Process Management)**  
每一个程序在运行的过程中，可称其为**进程（Process）**。操作系统中的一个重要模块就是要管理这些进程：
- 有序运行：排队、按顺序获取CPU时间片，执行一段代码。
- 创建、调度和终止：程序启动时创建进程，后台运行时调度，结束程序时终止。
- 进程间通信：不同进程间需要交换数据，进程管理模块提供了如管道、消息队列和共享内存等方式来实现。

::: tip
CPU时间片是个很有意思的概念。现代操作系统在运行时的进程数量远高于CPU核心数量，假如一个CPU运行一个进程，那么将会有大量的进程无法执行，出现我们常见的“卡死”现象。为了结局这一问题，进程管理模块提出了CPU时间片的概念，为每个进程分配不同的时间片，代码只能在规定时间内执行，时间一到，就要立刻换下一个进程执行。如此往复循环，加上CPU的计算和切换进程的速度（毫秒级）远超人类的感知速度。这样就实现了所谓的“多进程”运行效果了。
:::

2. **内存管理 (Memory Management)**  
   - 实现虚拟内存支持，允许程序使用比实际物理内存更大的地址空间。  
   - 提供分页和分段机制，优化内存使用效率。  
   - 管理内存分配与回收，防止非法访问。

3. **文件系统 (File System)**  
   - 管理文件的存储、检索和组织。  
   - 提供目录结构和文件权限控制。  
   - 支持多种文件类型和访问模式。

4. **设备管理 (Device Management)**  
   - 提供设备驱动程序接口，屏蔽硬件差异。  
   - 管理设备的初始化、配置和状态监控。  
   - 实现中断处理和缓冲机制。

5. **网络管理 (Networking)**  
   - 提供网络协议栈支持（如 TCP/IP）。  
   - 管理网络连接和数据传输。  
   - 支持分布式文件系统和远程资源共享。

6. **安全与保护 (Security and Protection)**  
   - 提供用户认证和访问控制机制。  
   - 实现加密和防火墙功能，保护系统免受攻击。  
   - 防止资源滥用和数据泄露。

7. **用户界面 (User Interface)**  
   - 提供图形化界面（GUI）或命令行界面（CLI）。  
   - 让用户能够直观地操作计算机。  
   - 处理用户的输入（如点击、按键）并显示结果。


操作系统的本质其实是一大堆程序的合集，其中包含操作系统自身的程序（主要用于管理系统资源-保障用户软件正常运行），和我们常用的软件程序（PPT、游戏、办公软件等）。下面先从操作系统自身的维度介绍几个核心程序。

### 进程调度器 - 交通指挥中心
当你同时打开微信、PPT和视频会议时，看似所有程序都在同时运行，实际上CPU每秒钟在不同程序间切换上万次。这得益于操作系统的进程调度技术：

**关键技术**
- **时间片轮转**：CPU时间片的概念是指程序获得了CPU使用权的一段时间。时间片轮转制度，可以让多个程序在短时间内都执行一部分代码。但每个程序运行20毫秒就必须让出CPU给其他程序，以此来保证多个程序“同时运行”，其实他们只不过是在快速切换而已，类似电影的原理。
- **优先级调度**：当然程序的命运并不相同，用户在意的进程会被操作系统优先处理，毕竟你也不想打游戏的时候突然来个系统更新吧。优先级调度是进程调度器中的一种评判程序是否应该重点执行的制度。高优先级的程序会优先被系统运行，理论上也会获得更多的CPU时间片。  

**生活中的例子**：  
- **游戏突然卡顿**：后台杀毒软件占用CPU时间片，导致游戏进程等待，如同电梯被占道堵塞。
- **开机速度缓慢**：过多自启动程序抢占CPU资源，系统在上百个任务间来回切换。

### 内存管理器 - 资源管理大师
如上所述，系统中的众多程序都是听从进程调度器的指挥运行的，那么系统是如何保证各个软件简的数据不会乱套的呢？
你的8GB内存电脑能同时运行微信、PS和游戏，其实全靠这个资源管理大师的魔法：

**关键技术**：  
- **内存隔离**：内存隔离通过地址空间隔离、权限控制等技术，将不同程序使用的内存独立，互相之间不侵犯。  
- **虚拟内存**：计算机的每一块内存都是有唯一的地址，但划分给所有程序并不够用，虚拟内存技术把硬盘空间伪装成内存，再将物理地址映射为虚拟的逻辑地址提供给程序，让每个程序都认为自己拥有整个内存空间。

**举例说明**：  
假设你的计算机有 8GB 的物理内存，运行了两个程序 A 和 B：
程序 A 和 B 各自拥有独立的虚拟地址空间（比如都是 8GB），但它们的虚拟地址并不直接对应物理内存。
操作系统通过页表将程序 A 和 B 的虚拟地址映射到实际的物理内存区域，可能只有部分数据被加载到物理内存中，其余部分存储在硬盘上的**交换空间（Swap Space）** 中。 

::: tip
打游戏时，由于使用资源过多，游戏程序通常不会将所有资源都提取到内存中，而是需要时从硬盘读取。例如**三角洲**摸金模式时打开箱子随机出现的物品，是在打开箱子时通过随机逻辑的代码确定物品，然后再从硬盘中加载对应图片的。所以如果你发现摸出来的物品加载图片缓慢，那么大概率你需要更换硬盘了。
:::

### 文件系统 - 数据持久保存
我们知道内存中的数据只有系统在运行时才存在。为了持久保存（断电不丢失）我们日常的文件、视频、游戏程序都保存在硬盘中，而不同的硬盘大小、空间地址甚至存储方式都不一样。此时文件系统就派上用场了。

::: tip
严格来说文件系统本身就是操作系统的一种，专门针对硬盘文件存取操作而设计的系统。但它通常都跟随操作系统一起出现，所以这里将其作为操作系统的核心能力介绍。
:::

**关键技术**：  
- **统一接口**：通过抽象逻辑结构（如文件和目录）屏蔽了存储设备的复杂性，使得用户能够方便地存储、访问和管理数据。 
- **数据存储**：将不同的文件数据规划、整理保存在硬盘中，在需要时可以快速索引到数据并读取，加载到内存中供程序使用。  

**常见的文件系统类型及其特点**：  
- FAT（File Allocation Table）
    特点 ：简单、兼容性强，适用于U盘和小型存储设备。
    缺点 ：不支持大文件（单个文件最大4GB），缺乏高级功能（如权限管理）。
- NTFS（New Technology File System）
    特点 ：Windows默认文件系统，支持大文件、权限管理和日志功能。
    应用场景 ：适用于桌面电脑和服务器。
- EXT（Extended File System）系列
    特点 ：Linux常用的文件系统（如EXT3、EXT4），支持日志功能和高性能。
    应用场景 ：广泛应用于Linux服务器和嵌入式设备。
- APFS（Apple File System）
    特点 ：专为苹果设备设计，优化了SSD性能，支持快照和加密。
    应用场景 ：macOS和iOS设备。
- 分布式文件系统
    特点 ：将数据分布在多个存储节点上，提供高可用性和扩展性（如HDFS、Ceph）。
    应用场景 ：云计算和大数据处理 。 

### 4. 设备管理器 - 万能适配大师
为什么新买的打印机插上就能用？这背后是设备管理器的超能力：

**兼容魔法**：  
- **驱动标准化**：不同品牌打印机使用统一指令集（像所有手机统一Type-C接口）  
- **即插即用**：U盘插入时自动唤醒相关服务（类似手机自动连接蓝牙耳机）  

**协同作战**：  
视频会议时同时调用：  
- 摄像头驱动采集画面  
- 麦克风驱动捕捉声音  
- 网络驱动传输数据  
三大驱动在调度器指挥下完成"多线程大合唱"

---


::: details 碎片关键词
* 操作系统家族树
* Linux发行版
:::



## 三、抽象之梯：从沙粒到摩天大楼

![抽象层级示意图](https://via.placeholder.com/600x400?text=Abstraction+Layers)

让我们通过一个日常场景看透操作系统魔法：

**场景**：手机拍照发朋友圈  
**表面操作**：打开相机 → 按下快门 → 选择分享到微信  

**背后协作**：  
1. **硬件层**：  
   - 调度器分配CPU时间给相机程序  
   - 内存管理器分配图像缓存空间  
   - 设备管理器启动摄像头传感器  

2. **系统层**：  
   - 文件系统生成照片的唯一ID  
   - 网络驱动准备数据传输通道  

3. **应用层**：  
   - 微信调用系统分享接口  
   - 压缩算法自动优化图片大小  

这个过程中，操作系统完成了：  
- 1000+次进程切换  
- 200MB内存动态分配  
- 3种硬件设备协同  
而你只需要轻轻按下快门。

---

## 四、未来操作系统：抽象思想的星际迁徙

当人类走向星辰大海，操作系统的思想正在突破计算机领域：

**量子计算**：  
- Qiskit框架用经典OS思想管理量子比特  
- 量子态管理类似内存保护（防止量子态坍缩=防止内存越界）

**脑机接口**：  
- Neuralink系统需要：  
  - 神经信号抽象（将脑电波转为标准化指令）  
  - 生物兼容性调度（平衡计算需求与大脑能耗）

**太空殖民**：  
- 火星基地OS设计挑战：  
  - 20分钟通信延迟下的异步任务管理  
  - 核电池能源配额系统（类比进程优先级调度）

**思想革命**：  
> 操作系统的终极形态可能消失在具体代码中，但其"分层抽象-资源隔离-标准化接口"的思想，正在成为人类应对复杂系统的基础思维模型。从城市规划到气候治理，这个诞生于计算机实验室的智慧，正在重塑我们理解世界的维度。

---

**结语**：  
下次当你滑动手机屏幕时，请想象背后那个隐形指挥家——它正在用精密的抽象魔法，将冰冷的硬件指令转化为温暖的数字体验。而这种化繁为简的智慧，或许正是人类在浩瀚科技宇宙中导航的终极罗盘。