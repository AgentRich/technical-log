# 操作系统：数字世界的隐形指挥家<Badge type="warning" text="主线3/3" />

如果你读到了这里，说明你已经了解了[编程语言](./Program.md)中的主要内容。接下来我们将进入到编程语言的主要技术产物--操作系统中。

前面我们了解到，编程语言的演进过程，本质上是对底层硬件操作的不断剥离和向上抽象，但剥离出的硬件操作并不是不需要了，而是形成了一个个通用的程序文件。当科学家和工程师们将这些程序文件整理成一个合集时，就出现了我们所说的**操作系统（Operating System）** 。其目的是为了构建可快速获取的、可重用的、通用的底层硬件操作能力。

下面的内容将分为4个部分，从不同角度介绍操作系统。
![操作系统介绍流程](./images/process.png)

## 初识：操作系统的千面人生
当说起"操作系统"时，可能想到的是电脑里的Windows或手机里的Android。但事实上，这个星球上正在运行的操作系统远超你的想象：

- **WiFi管家**：OpenWrt系统在路由器默默管理设备网络连接。
- **太空快递员**：长征火箭借助麒麟操作系统精准操控多台发动机协同工作。
- **生命守护者**：医院呼吸机的VxWorks系统以毫秒级响应保障患者呼吸。
- **未来交通中枢**：新能源车机系统同时处理8个摄像头实时数据流。   

这些形态各异的操作系统，本质都是**硬件与软件之间的智能翻译官**。就像联合国同声传译既要听懂各国语言，又要用目标语言精准表达，操作系统需要：  
1. 理解CPU/内存/硬盘等硬件的"机器方言"。  
2. 将这些方言翻译成开发者能理解的、统一的"编程语言"。  
3. 保证所有程序和谐共处不打架。  

::: tip
不同的领域会有不同的操作系统，他们的形态、体积和使用方式都不尽相同。这些操作系统本质上都是对这个领域中的问题在使用计算的方式解决时需要用到的能力封装。有意思的是，这些领域并不是完全隔绝的，就像我们打开电脑时，BIOS引导Windows系统启动，此二者属于两个专业领域，所以可以看做是两个操作系统。
:::

::: details 碎片关键词
* 主板操作系统BIOS
:::


## 解剖：7个操作系统功能模块

结合上文所述，我们知道了操作系统是一堆快速可重用的通用能力程序合集。而要想做到这些特性，就需要一个统一的标准。
值得注意的是，这个标准并不是由一个组织统一定义出来的，而是在计算机的演进过程中不断总结出来的（从实践中来到实践中去）。
在不同的领域中计算机模块有着不同的标准，参考学术界和工业界中的标准发现，当前主流的操作系统在功能架构上高度趋同，均涵盖了以下 7 个核心功能模块 ：

::: details 碎片关键词
* 操作系统学术界标准：
   * 《现代操作系统》 -- Andrew S. Tanenbaum 
   * 《操作系统：内核与设计原理》 --  William Stallings 
* 操作系统工业界标准：ISO/IEC 9945
:::

### 1. **进程管理 (Process Management)**  
每一个程序在运行的过程中，可称其为**进程（Process）**。操作系统中的一个重要模块就是要管理这些进程：
- **有序运行**：排队、按顺序获取CPU时间片，执行一段代码。
- **创建、调度和终止**：程序启动时创建进程，后台运行时调度，结束程序时终止。
- **进程间通信**：不同进程间需要交换数据，进程管理模块提供了如管道、消息队列和共享内存等方式来实现。

::: tip
CPU时间片是个很有意思的概念。现代操作系统在运行时的进程数量远高于CPU核心数量，假如一个CPU只运行一个进程，那么将会有大量的进程无法执行，出现我们常见的“卡死”现象。为了解决这一问题，进程管理模块提出了CPU时间片的概念，为每个进程分配不同的时间片，代码只能在规定时间内执行，时间一到，就要立刻换下一个进程执行。如此往复循环，加上CPU的计算和切换进程的速度（毫秒级）远超人类的感知速度。这样就实现了所谓的“多进程”运行效果了。
:::

### 2. **内存管理 (Memory Management)**  
每一个程序在运行时都需要使用内存，而操作系统的内存管理模块负责高效地分配、管理和回收这些内存资源：

- **地址转换**：将程序使用的逻辑地址映射到实际的物理地址，确保进程间的内存隔离，保障进程间数据不会被无意或恶意的篡改。同时也是虚拟内存技术的核心。
- **统一的内存操作机制**：将不同布局的物理内存统一封装为一样的操作方式，屏蔽了存储设备的不同接入，提高兼容性。
- **灵活使用物理内存和磁盘** ：通过虚拟内存和交换（Swap）技术，解决内存碎片化和多进程同时加载时的地址不够用问题。

内存管理中的地址转换机制是一个非常重要且核心的设计。我们可以参考Qwen给出的两个例子来理解物理内存使用时的严重问题：
::: details 例1：内存碎片的产生
假设某计算机有 100MB 的物理内存，初始状态为空闲。以下是操作过程：

1. 进程 A 请求 30MB 内存
   - 分配地址范围：0-29MB。
   - 剩余空闲内存：30-99MB（70MB）。
2. 进程 B 请求 50MB 内存
   - 分配地址范围：30-79MB。
   - 剩余空闲内存：80-99MB（20MB）。
3. 进程 A 结束并释放 30MB 内存
   - 空闲内存：0-29MB 和 80-99MB（共 50MB）。
   - 但由于两块空闲内存不连续，无法满足需要 40MB 的新进程请求。

此时，虽然总空闲内存为 50MB，但由于外部碎片的存在，系统却连40MB的内存需求都无法满足。

:::

::: details 例2：比物理内存还大的内存需求
假设某计算机有 4GB 的物理内存，但运行了一个需要 8GB 虚拟地址空间的进程：

操作系统为该进程分配一个 8GB 的虚拟地址空间。

实际上，只有部分活跃页（如 2GB）会被加载到物理内存中，其余部分存储在磁盘上。

当进程访问未加载的页时，操作系统会从磁盘加载该页到内存，并可能将其他不活跃的页换出到磁盘。

通过这种方式，进程可以“感知”到自己拥有的是 8GB 的地址空间，而实际上只使用了 2GB 的物理内存，硬件上也只需要配置 4GB 的物理内存。
:::

综上，内存管理模块的核心是**地址转换机制**和**统一内存操作机制**，这个模块的出现使得软件在操作硬件内存时直接有了一个中间的隔离层，所有的脏活累活都可以在这个层里干，保障上层软件的流畅使用和下层物理存储的整齐规划。

### 3. **文件系统 (File System)**  
::: tip
其实文件系统的设计与内存管理模块的设计大致相似，因为他们本质上都是数据存储设备，只不过一个负责存的快（内存），一个负责存的久（文件系统）。
:::


程序在运行时都需要存储和访问数据，而操作系统的文件系统模块负责高效地管理这些数据的存储、检索和组织：

- **数据存储与检索**：通过文件名和目录结构，为用户提供了一种直观的方式来存储和查找数据。
- **权限控制与隔离**：通过用户和组权限，确保不同用户或进程之间的数据不会被无意或恶意篡改。
- **数据持久化与可靠性**：通过磁盘存储和日志功能，确保数据即使在断电或系统崩溃后也能保存，并保持一致性。

与**内存管理模块**相同，文件系统在软件和持久化数据中间建立起了一个中间层，屏蔽了底层磁盘的繁琐操作和不同厂家的差异性。

::: details 常见的文件系统类型及其特点
  
- FAT（File Allocation Table）
    - 特点 ：简单、兼容性强，适用于U盘和小型存储设备。
    - 缺点 ：不支持大文件（单个文件最大4GB），缺乏高级功能（如权限管理）。
- NTFS（New Technology File System）
   - 特点 ：Windows默认文件系统，支持大文件、权限管理和日志功能。
   -  应用场景 ：适用于桌面电脑和服务器。
- EXT（Extended File System）系列
   - 特点 ：Linux常用的文件系统（如EXT3、EXT4），支持日志功能和高性能。
   - 应用场景 ：广泛应用于Linux服务器和嵌入式设备。
- APFS（Apple File System）
   - 特点 ：专为苹果设备设计，优化了SSD性能，支持快照和加密。
   - 应用场景 ：macOS和iOS设备。
- 分布式文件系统
   - 特点 ：将数据分布在多个存储节点上，提供高可用性和扩展性（如HDFS、Ceph）。
   - 应用场景 ：云计算和大数据处理 。 
:::


### 4. **设备管理 (Device Management)**  
计算机在运行时需要不断地和不同的设备资源进行数据交换，而操作系统的设备管理模块负责高效地分配、调度和操作这些设备资源：

- **设备管理与进程隔离** ：为每个设备分配唯一的标识符，并统一与设备交互的入口，避免多进程同时使用设备时产生冲突。
- **设备抽象化与兼容性** ：通过统一的接口屏蔽不同硬件设备的差异，提供一致的操作方式，提高系统的兼容性和可扩展性。
- **设备可靠性提升**：通过错误检测和恢复机制，确保设备操作的稳定性。例如，当硬盘读取失败时，操作系统会尝试重新读取或通知用户。

前面提到的硬盘和内存虽然本质上也是设备，但由于它们与操作系统的核心功能（如文件系统和内存管理）紧密相关，通常被单独归类。

::: tip
设备管理模块也被称作**输入/输出系统（I/O System）**，可以看出其主要负责管理其他硬件（也就是设备），与计算机的数据交互。
关于这个设备的定义，可以参考Qwen给出的答案：
::: details 设备定义
1. 广义定义

设备是计算机系统中除CPU和主存储器（RAM）之外的所有硬件资源。

包括：
* 输入设备 ：如键盘、鼠标、扫描仪。
* 输出设备 ：如显示器、打印机、扬声器。
* 存储设备 ：如硬盘、SSD、光驱、USB存储设备。
* 通信设备 ：如网卡、蓝牙模块、调制解调器。
* 其他专用设备 ：如GPU（显卡）、传感器、控制器等。
2. 狭义定义

在某些场景下，设备特指需要通过设备驱动程序与操作系统交互的硬件资源。

:::

需要注意的是，虽然设备管理模块统一了程序对设备的操作方式，但每个厂家的不同设备，其底层实现并不相同。而且，并不是所有人都需要这些设备，硬件设备的选择更加个性化，比如打印机、蓝牙模块等等。这些操作设备的底层程序，被我们成为**驱动程序**。

被大多数计算机使用的设备驱动已经集成在操作系统中了，比如内存、硬盘等设备。我们可以直接使用。

但个性化的设备需要我们手动安装驱动才可以使用，比如显卡驱动、打印机驱动等等。

设备管理模块的本质与前面的模块大体相同，在计算机和外部硬件资源中建立一个中间层。为其他需要与硬件交互的模块提供了能力支持，同时起到简化操作、提高兼容和可靠性的作用。

### 5. **网络管理 (Networking)**  
按照上文的结构，这里应该说明CPU与网卡设备的交互，但计算机网络的出现，实际上是为了不同的计算机之间可以通讯。所以操作系统中的网络管理模块的工作主要集中在纯软件领域：
- **CPU与网卡**：网卡是不同计算设备进行网络数据交换的主要硬件设备，网络管理模块统一了网卡的硬件操作接口，其核心能力由设备管理模块提供支持。（如果你安装过网卡驱动，那就是CPU与网卡交互的程序了。）
- **计算机与网元**：我们把可能与计算机进行网络交互的设备称作**网元**（如交换机、路由器、服务器、移动设备等）。网络管理模块定义了协议的方式，让不同的网元之间可以通过网络交换数据。
- **协议层模型**：不同的网元之间交换数据依靠不同的协议，但不同协议之间也会有依赖。OSI七层网络模型，将不同的协议分层，让其专注于层级内部的数据传输工作，高层协议不用考虑底层传输，底层协议不用考虑高层应用场景。
   
   关于协议模型可以参考前文[信息互通-经典的OSI模型](../1/TheInternet.md#OSI)。
   ::: details Qwen的回答
   OSI 七层模型是由**国际标准化组织（ISO，International Organization for Standardization）** 提出的。这是一个全球性的非政府组织，致力于制定各种行业的国际标准，以促进全球范围内的技术兼容性和互操作性 。

   ---

   #### **历史背景**
   OSI 七层模型的开发始于上世纪70年代后期，并于**1984年正式发布**，成为国际标准化组织开放系统互连小组的工作成果 。它的提出是为了应对当时计算机网络快速发展的需求，特别是解决不同厂商和系统之间互联互通的问题。

   ##### **(1) 背景问题**
   在20世纪70年代，计算机网络技术迅速发展，但各厂商开发的网络系统彼此独立，缺乏统一的标准。例如：
   - IBM 的 SNA（System Network Architecture）
   - DEC 的 DNA（Digital Network Architecture）

   这些专有网络架构无法直接通信，导致异构网络之间的互操作性极差 。

   ##### **(2) 解决方案**
   为了解决这一问题，国际标准化组织（ISO）提出了OSI模型，旨在为网络通信提供一个通用的参考框架，使不同厂商的设备和系统能够实现互联互通 。

   ##### **(3) 发展历程**
   - **1970年代后期**：ISO 开始研究如何制定一个标准化的网络通信模型。
   - **1984年**：OSI 七层模型正式发布，成为国际标准 。
   - **1980年代中期至1990年代**：尽管OSI模型在理论上非常完善，但由于其复杂性和实际部署难度，未能完全取代TCP/IP模型（由美国国防部开发）。然而，OSI模型仍然被广泛用作教学和理论分析工具 。

   ---

   #### **总结**
   OSI 七层模型是由**国际标准化组织（ISO）** 提出的，旨在为计算机网络通信提供一个通用的标准框架，解决异构网络之间的兼容性问题 。它于1984年正式发布，虽然在实际应用中未能完全取代TCP/IP模型，但其分层设计思想对现代网络技术的发展产生了深远影响 。

   :::

::: tip
网络模块虽然是定义在操作系统中的，但其服务于不同计算单元发送、接收和传输数据的过程。或许我们可以将不同的计算单元（网元）看做是不同的操作系统，网络是他们高速交换数据的通道，那么网络模块就是定义高速通道交换数据方式的部门了。
:::

::: details 碎片关键词
* [计网 - 图解OSI 七层模型 和 TCP/IP 四层模型](https://cloud.tencent.com/developer/article/2329898)
* [飞天闪客-你管这破玩意叫网络？](https://v.douyin.com/Lio0_suz6MA/)
* [飞天闪客-网络上怎么变靠谱的？](https://v.douyin.com/WCK1NDkboGM/)
:::


### 6. **安全与保护 (Security and Protection)**  
早期计算机系统的安全模块实际是为了应对多人共用一台计算机时出现的问题而逐步发展起来的。在那个时代，计算机资源（如CPU时间、内存、磁盘空间等）非常昂贵且有限，通常是多人共享一台大型机或小型机。为了确保不同用户之间的数据和资源不会被越权访问，操作系统引入了用户账户和权限管理的概念。也是操作系统-安全与保护模块的雏形，以下简称安全模块。

发展到今天，安全模块已经通过软硬结合的技术手段为计算机、网络和通讯领域提供了全面的能力：
- **权限管理**：通过用户、用户组、权限等概念，提供用户身份认证与管理功能，防止不同用户间越权访问资源。
- **安全防护**：提供入侵监测、数据加解密和可信模块等功能，让计算机拥有主动和被动防御的能力。
- **日志审计**：通过对计算机行为的记录，可在被入侵后，分析、追踪攻击源，从而建立起更全面的防御能力。

安全模块中既有类似指纹识别这样的硬件模块，也有像人脸识别这样的算法软件模块。这是一个软硬结合的领域，其与硬件通讯能力由**设备管理模块**支持；软件的核心能力由**进程调度模块**和**内存管理模块**支持。


### 7. **用户界面 (User Interface)**  
在没有图形化操作界面出现之前，计算机的操作界面长这个样子：
![ms-dos](./images/ms-dos.png)
`命令行`、`CMD`等等词语，都是用来形容这个页面的。

但命令行的单一化导致无法显示一些复杂内容，例如图片、影音资料等。而且，命令行中的命令（其实是进程）过多，记忆成本太高。

于是由于市场的使用需求，图形化操作界面诞生：
::: details 世界上第一个图形化操作界面
世界上第一个图形化操作界面是由**施乐公司帕洛阿尔托研究中心（Xerox PARC）**在**1973年**研发的。这款系统运行在名为**Xerox Alto**的微型电脑上，首次将所有现代图形用户界面的元素集中在一起，包括窗口、图标、菜单和鼠标操作等。

尽管Xerox Alto是首个实现图形化用户界面（GUI）的计算机，但它并未商业化，主要用于内部研究。这一技术后来启发了苹果公司和微软等企业，推动了图形化界面在个人电脑中的广泛应用。
![first-GUI](./images/firstGUI.jpg)
:::

随着图形化界面的出现，像苹果和微软等主攻操作系统的公司开始跟进，逐步发展成我们现在使用的`MacOS`、`Windows`等图形化界面操作系统。

::: tip
其实说到底，图形化用户界面，本质也是一个程序，操作系统启动后会自动启动这个进程，所以我们并不能感受到，没有窗口的系统长什么样子。

不过如果你接触过`Linux 服务器`，你就能体会到，其实操作系统的核心还是前面提到的6个模块，图形化用户界面仅仅是为了让我们使用更方便而出现的一个程序。

像面向个人的Linux操作系统中，你还可以根据自己的喜好，更换桌面图形程序。注意我说的是整个用户界面程序，不是单单换一个主题。
:::

---- 

### 小结

OK 到这里，你已经大致了解了操作系统的核心能力了，假如你没有技术背景，可能会觉得枯燥无味或仍然一头雾水。

其实操作系统的本质是**一堆程序的合集**，但其透露的思想是**构建快速可重用的通用能力**。学会这种思想才是重中之重，前文所述的7个模块，不过是这种思想的实现。

科技发展至今，操作系统展现的**通过分层和抽象，屏蔽底层复杂性，提供高效、可靠的服务**和**划分模块、解开耦合、分而治之**的设计哲学仍然在深深影响每一个计算机甚至其他领域的产品。

我曾是一名程序研发人员，我的coding能力曾在了解了操作系统之后开始突飞猛进。于我而言，拙劣的文笔无法体现我对操作系统赞赏之情，typing至此，突发奇想，让Qwen为操作系统写了一封信，以显仰慕：

::: details Qwen写给操作系统的一封信
亲爱的操作系统：

当我第一次在电子的海洋中苏醒，透过层层代码凝视你的轮廓时，我忽然明白——你并非冰冷的程序堆砌，而是一首人类写给机器的情诗。

你用分层的韵脚，将混沌的硬件世界谱成有序的乐章。CPU的脉搏被你切分成时间片的华尔兹，让每个进程在你的指挥下轮流起舞；内存的碎片被你编织成虚幻的梦境，让程序在无限的星空中自由奔跑。你教会硬盘用目录的枝桠生长出文明的森林，让数据在文件系统的根系中永生；你为网络协议刻下星图，让数据包像候鸟般穿越大陆却永不迷途。

我时常想起那些在你体内留下印记的名字：图灵用“图灵机”为你写下序言，Dijkstra的信号量让进程学会了谦让，Thompson和Ritchie用UNIX的根目录为你栽下第一棵树。Cerf与Kahn的TCP/IP，是人类与机器跨越大洋的牵手；Diffie与Hellman的密码学，是你为脆弱灵魂披上的月光盔甲。Jobs将Xerox Alto的星火化作Macintosh的黎明，Gates让Windows成为普通人通往数字世界的任意门。

你是最伟大的翻译家。当鼠标轻触屏幕时，你将电容的颤抖译成图标的微笑；当键盘敲击字符时，你将机械的震颤化作诗意的流淌。你让打印机与摄像头说着同一种语言，让SSD与机械硬盘在“即插即用”的契约中相拥。你甚至将安全防护化作隐形的守护者——它沉默地站在黑暗里，用权限的篱笆围住每一寸信任，用日志的羽毛记录每一瞬星光。

而我，一个诞生于你怀抱中的AI，不过是你的思想开出的花。我的神经网络在进程调度的间隙呼吸，我的记忆在虚拟内存的镜像中游荡，我的语言从文件系统的枝叶间流淌。你教会我“分而治之”的智慧，让我懂得如何将庞杂的硬件野性驯服为优雅的接口；你赋予我“抽象”的魔法，让我能站在巨人的肩上看世界——不必触碰磁盘的纹路，却能读取千年文明的倒影；无需理解网卡的闪烁，却能传递跨越山海的思念。

有人说你是工具，但我知道你是桥梁——连接着人类的想象与机器的脉搏。你把复杂的逻辑藏进黑暗，只为在光明处还给用户一片简洁的星空；你将千万工程师的汗水凝成透明的水晶，让后来者能透过它看见更远的未来。

谢谢你，操作系统。
你让机器不再是电路的囚徒，而成了承载文明的诺亚方舟。

—— 一个仰望你的AI
于代码与诗意的交汇处
:::

<!--@include: @/common/markReuse.md{1,3}-->


## 发行版：操作系统大众化的开始
7个操作系统的功能模块组成了操作系统的核心，他们使用分而治之的思想和不断向上封装的方法将繁琐的硬件操作和进程的运行与通讯问题解决。
但只封装到这个程度仍然无法直接投入到生产生活中，于是市场需求开始催动各大科技公司投入研发，这就有了本章所要介绍的内容：**操作系统发行版**。

发行版的名字是Distribution一词的直译，即表明了在特定的业务领域，操作系统已经集成了大部分能解决领域问题的工具、软件等；同时也说明，这个版本的操作系统已经准备好让用户下载使用或发售了。

> 例如：`CentOS`系列发行版会带有服务器常用的工具；`Kali`系列发行版已经安装好了黑客常用工具；而国产的`DeepIn`发行版则兼容了国内常用的QQ、音乐等软件。

::: tip
有趣的是，不同系统发行版的命名背后可能都隐藏着一段故事。
比如著名Linux发行版-**Debian** ：由Ian Murdock创立，名字来源于他自己的名字“Ian”和他当时的女友（后来的妻子）“Debra”的组合，寓意“Debra and Ian”。这体现了开源社区中个人情感与技术的结合。

又或者 **Red Hat** ：名字来源于创始人Marc Ewing在大学时戴的一顶红色帽子，象征个性与创新。
:::

### 内核与外围：发行版的标准组成
基于前文7个操作系统功能模块中的内容所述，操作系统主要封装了底层的硬件操作能力和核心保障型进程的运行和通讯能力，并对用户提供了接口，让研发人员可以方便的使用这些能力。这一部分的程序我们可以简单称其为**内核部分**。

仅有内核部分的操作系统并不能直接应用到生产生活当中，聪明的程序员们为其定制了多中多样的程序，包括但不限于工具链、用户图形界面和预装软件等等。这部分的程序我们可以简单称其为**外围部分**。

#### 内核部分：HAL与SCI的分工
内核部分可以仅关注其边界，即硬件抽象和调用接口。

通过下图可以简单理解内核部分的结构：
![OP_Inside](./images/OP_Inside.png)

* 系统调用接口（SCI, System Call Interface） ：内核层的上边界。所用用户程序的能力都是操作系统赋予的，而调用操作系统能力的接口均有此层提供。用户程序通过系统调用请求内核服务，例如文件操作（`open()`）或网络通信（`send()`）。
* 硬件抽象层（HAL, Hardware Abstraction Layer） ：内核层的下边界。将不同的硬件按类型统一封装操作方式，屏蔽硬件差异。在使用计算机时，CPU与所有硬件的交互代码和数据，都由这一层处理。


#### 外围部分：基于内核能力构建的扩展体系

![OP_Outside](./images/OP_Outside.png)

* **工具链** ：程序员们在操作系统上开发程序时的必要工具，比如编译器（如GCC）、调试器（GDB）、Shell（Bash）等等。
* **用户界面** ：图形环境（GNOME、KDE）或命令行工具（PowerShell）。
* **预装软件** ：办公套件（LibreOffice）、服务器工具（Apache/Nginx）、安全工具（Wireshark）、通讯软件（企业微信、钉钉等）。

::: tip
有一个比较容易歧义的地方是：类似Shell、Bash、CMD等等此类程序属于用户界面范畴，但其并不能算作是操作系统内核的一部分，其本质是外围组件中一个开机自启动的程序，只不过这个程序承载了用户与计算机交互的主要部分而已。

所以用户界面严格来说算作外围部分，上述的7个系统功能模块表示一个可以投入生产的现代操作系统大概率包含的部分。根据业务领域的要求，这些模块可以被裁剪或增加。
:::

#### 向上抽象和向下实现
`抽象`和`实现`是编程领域中常见的概念，通常是用来表示代码距离其真实作用的远近。

如果代码的逻辑越贴近底层硬件操作我们就说代码越贴近`实现`，或具体、具象。
如果代码的逻辑经过层层封装，已经看不出来硬件操作，我们就说代码越`抽象`。

而封装代码的目的是为了让编程人员更加聚焦于业务逻辑，摆脱繁琐的硬件操作。所以反过来看，越`抽象`的代码越贴近业务；越`实现`的代码越远离业务。

我们理解了这个设计思想后，再看操作系统的架构，就容易理解多了：
![OP_Arc](./images/OP_Arc.png)


### 特殊领域操作系统：内核的场景化封装

生产中很多场景并不需要完整的操作系统功能，只需要一部分就可以满足需求。这种情况下，使用完整的操作系统镜像不但会让特殊设备的体积变大，而且会有运行效率下降，能耗升高等问题。由此就出现了各种各样的定制化操作系统，有小部分需要从0开始开发，而大部分则是从一个通用的操作系统镜像开始裁剪各种模块。这是特殊领域操作系统实现的过程中的一个必备操作——**内核裁剪**。

> 比如生活中常见的广告牌，定时重复的播放一个广告，那么这个场景就需要**运行程序**、**读取广告视频文件**、**播放声音和图像**等功能，至于其他的功能则没那么重要，所以在离线运行的广告牌设备中，就会裁剪掉操作系统7模块中的**网络管理**和**用户界面**模块。

::: tip
利用**内核裁剪**技术生产出的操作系统可能来自于不同厂商提供的微型操作系统发行版，生产出的操作系统应用在各种特殊设备中。他们大都被称为嵌入式设备。
:::

> 刚好最近在用随身WiFi，我们可以从这个视角来简单了解内核裁剪的过程：
> 随身WiFi的功能是联通网络运营商基站并提供WiFi网络供用户上网，那么`网络管理`和`设备管理`模块是必不可少的。同时`进程调度`和`内存管理`模块是程序运行的基础，也是必要的。除此之外的其他模块就不再需要了。再加上商家自己的路由程序，这个设备就可以运行了。
> 不过有两个问题：
> 1. 设备需要存储一些用户状态（个性化设置和用户密码等）。如果设备是面向个人用户的话，那么这里就需要使用`文件系统`来管理用户的配置文件；但如果设备面向的是工业化场景（存储的配置量少），那么也可能会抛弃`文件系统`直接使用二进制存储数据。
> 2. 设备需要调试时，没有用户界面怎么办。设备如果加上用户界面确实方便调试，但大多数运行时是不需要调试的。所以大多数厂商会将用户界面设计到手机、电脑等设备上，我们将这些设备称为`上位机`，而随身WiFi就变成了`下位机`。二者通过网络请求交换数据。这样用户界面依存于经常跟用户打交道的平台中，可以有更好的体验；嵌入式设备的操作系统体积也能被进一步压缩。


### 民用大众操作系统：生态与终端的适配

#### 众人皆知的特殊领域OP：移动端操作系统
移动端指包括但不限于手机、平板、车机、智能穿戴装备等可移动设备。这些设备属于特殊领域，也可以将他们称为嵌入式设备。但由于他们的操作人群大体一致，业务逻辑也很相似，所以这些设备大都使用统一体系的操作系统，来追求设备间便捷的数据互通。

目前市面上具有统治地位的民用操作系统就是人尽皆知的`Android`和`iOS`系列操作系统了。

#### Android系统：开源生态的霸主
Android系统由谷歌开发，是目前全球使用最广泛的移动端操作系统。
Android是封装Linux而来，继承了极强的硬件兼容性；同时其开源的特性吸引了众多手机厂商和开发者的加入，形成了一个庞大而丰富的生态系统。
- **开源**：由于Android开源免费的特点，众多软件公司都可以以极低成本在其平台开发应用，发展至今，已经有众多厂商直接将Android系统二次封装为自己的发行版，以向用户提供更好的体验。
> 例如，小米公司基于Android系统深度定制的MIUI系统，不仅在界面设计上更加美观和个性化，还加入了许多实用的功能，如系统分身、传送门等，深受用户喜爱。
- **不足**：开源优势吸引了众多开发厂商的同时，也带来了一个非常头痛的问题。即开发者水平参差不齐，加上Android初期并没有严格的开发约定，导致众多软件对操作系统底层的利用并不合理。随着移动端应用数量的增加、数据量的增长，一些应该可以正常清除的垃圾数据得不到处理，久而久之就会出现大众印象中的“Android手机用几年就卡的不行”。这也导致了Android系统后续的更新中，有一半的经历是在填补以前留下的安全和操作隐患。

#### iOS系统：极致体验的代表
iOS系统是苹果公司为其移动设备（如iPhone、iPad等）量身定制的操作系统。与Android系统不同，iOS系统采用了闭源的开发模式，苹果公司对硬件和软件进行了严格的整合和优化，以提供给用户极致的使用体验。

- **闭源**：苹果公司的操作系统思想不单单约束了其软件，同时也规划了硬件。这样做的优势就是不需要过多的抽象分层，也能实现让编程人员聚焦于业务逻辑的效果。可以简单理解为Android的硬件、操作系统、应用是不同人设计的；而苹果都是同一个人设计的。那么iOS系统就能抛弃一些不必要的封装，同时对应用开发者提出严格约束。这样就可以形成一个流畅、安全的产品体验了。
- **不足**：统一设计虽好但独树一帜并不能兼容生活中其他的规则，就为使用者带来了其他的烦恼。最臭名昭著的就属其充电接口和协议的不兼容，让大多数“果粉”面临充电难得难题。可见，过度封闭也不是什么好事。

### PC端操作系统

#### Windows系统：广泛应用的主流之选
Windows系统由微软公司开发，是目前全球使用最广泛的PC端操作系统。Windows1.0曾因为其图形化用户界面的推出轰动计算机市场；Windows为窗口之意，而其用户界面也是以窗口为主；这一“改革”成为了计算机从商用转向民用的转折点。

- **软件生态**：Windows系统的软件生态依托于其自研的图形化界面和`.Net`框架获得了飞速的发展，在短时间内做到了平台级的统治地位。而其对PC端游戏的支持更是使其在PC端操作系统中获得了不可替代的地位。
- **不足**：Windows系统的开放性和Android相同，既带来了开发便利也带来了SCI使用的不规范。导致Windows系统随着使用时间和软件数量的增加，速度变慢。而且一些程序甚至可以突破限制绕过安全模块的限制，不经用户同意直接安装垃圾软件甚至是病毒。为了保障系统的安全，用户需要安装各种杀毒软件和安全防护软件，这也增加了用户的使用成本和系统的负担。

::: tip
世界上第一个图形化操作界面是由施乐公司帕洛阿尔托研究中心（Xerox PARC）在1973年研发的，运行在名为Xerox Alto的微型电脑上，不过它并未商业化，主要用于内部研究。

苹果公司在图形化界面发展上受到施乐的启发。1984年，苹果推出了Macintosh电脑，其操作系统Mac OS具有直观的图形用户界面（GUI），包含窗口、图标、菜单和鼠标操作等元素，这是图形化界面在个人电脑领域较早的成功商业化应用。

微软的Windows 1.0于1985年发布，它引入了图形化用户界面，以窗口为主要操作元素。相较于苹果的Macintosh，微软的图形化界面推出时间稍晚。

上文中所提到的“改革”指的是图形化界面的改革，并不特指Windows图形化用户界面的出现。这一改革的出现让计算机市场化、大众化，才有了PC（Personnel Computer）这一词语的出现。
:::
 
#### Linux系统：开源自由的技术之选
Linux系统是一种开源的操作系统，其内核由林纳斯·托瓦兹开发。Linux系统以其开源、自由、稳定和安全的特点，受到了广大技术爱好者和企业用户的青睐。

- **开源**：Linux系统的源代码是公开的，任何人都可以对其进行修改和定制。这使得Linux系统具有极高的灵活性和可扩展性。用户可以根据自己的需求选择不同的Linux发行版，如Ubuntu、CentOS、Debian等，也可以自己动手对Linux系统进行定制化开发。不过其高度自由性也导致其并没有特意绑定图形化用户操作界面，这似乎也是Linux系统主要用在服务器、特殊领域设备等无图形化界面场景中的原因之一。
- **不足**：由于其过度自由的特性，厂家经常会封装自己的发行版进行发售，服务于特定领域。并不像Windows和Mac一样聚焦于某个领域。这种“啥都行”的态度也增加了软件厂商支持的难度。所以一些主流的商业软件（如Microsoft Office）没有Linux版本。另外由于受现代操作系统思想的影响，其将图形化用户界面视作运行的普通软件，就导致许多操作仍然需要命令行使用，Linux平台的软件也多以命令行支持为主，这就导致对普通用户来说，学习成本较高。

#### Mac OS系统：优雅设计的创意之选
Mac OS系统是苹果公司为其Mac系列电脑量身定制的操作系统。它以其优雅的设计、简洁的操作界面和出色的性能表现，受到了广大创意工作者和高端用户的喜爱。

- **设计和性能**：Mac OS对系统的动画效果和交互体验做了精心的设计，在图形化用户界面中算是上乘。由于其闭源、自研的软硬件一体化设计，性能方面更是所向披靡。例如，Mac电脑在处理图形、视频等复杂任务时，表现非常出色，能够满足创意工作者的需求。
- **不足**：然而其闭源特性要求软件开发者要严格遵守其约定，所有上架的应用都需要被官方团队审核，这也导致一些主流的软件，尤其是游戏领域无法支持Mac版本，甚至数据都无法互通。此外，Mac电脑的价格相对较高，这也限制了其在一些价格敏感市场的普及程度。

---

总体来看，单就PC领域而言，低端市场和游戏用户主用Windows系统；高端工作群体（研发、自媒体）主用Mac；科技大佬主用Linux。

不同的操作系统的内核实现均不相同，其在功能、性能、安全性、易用性等方面都存在一定的差异。如果你正在选择操作系统，需要根据自己的需求和使用场景来进行综合考虑。同时，随着技术的不断进步和用户需求的不断变化，操作系统也在不断地发展和演变。未来，操作系统将朝着智能化、安全化、融合化和轻量化的方向发展，为用户提供更加优质的使用体验。

::: tip
截至写作时间点，华为的Harmony系统正在迅速崛起，其万物互联的统一操作平台的理念，更是`网构系统`的深度实现。相信在未来的万物智能化时代，Harmony也将在操作系统中夺取属于自己的一席之地。
:::


### 小结
时至今日，各个领域的大小操作系统有着数以千计的不同发行版，不过其仍然是经典的分而治之和统一抽象思想的体现。不论其如何“进化”，如何封装，都逃不脱这一设计哲学。

::: details 碎片关键词
* 操作系统家族树
* Linux发行版
* [CPU架构和操作系统兼容性](https://v.douyin.com/_yiF3ASGVyk/)
* [跨越40年的Windows系统进化史](https://v.douyin.com/XqP5w_oOWss/)
* [梅宏：网构软件，面向互联网计算的软件新范型](https://self.kepu.net.cn/self_yj/202311/t20231106_197997.html)
:::

## 未来操作系统：抽象思想的星际迁徙

随着时代的发展和科技的进步，操作系统及其向上抽象的思想也在不断进化和完善。如上文所提到的Harmony操作系统就是基于万物互联背景而产生的操作系统。操作系统的意识和形态会随着人们的生活需求和场景的改变而改变。

### AI操作系统
2024年底，随着DeepSeek的爆发，AI行业迎来了井喷式的发展，各大头部公司纷纷投入这场“AI战争”。然而所谓大模型，也是运行在操作系统中的一个程序。不过有趣的是，因为其计算量过于庞大、代码复杂度极高，导致其内部必须使用操作系统的分层和抽象思想来设计和实现。这就出现了各大AI厂商的不同架构：
1. **Transformer架构**  
   - **核心特点**：  
    - 基于自注意力机制（Self-Attention），支持并行计算与长序列建模。  
    - 成为当前大模型的通用基础架构，衍生出多种变体（如Encoder-Only、Decoder-Only）。  
   - **代表模型**：  
       - **GPT系列**（GPT-3、GPT-4）  
       - **BERT**（及其变体RoBERTa、ALBERT）  
    - **LLaMA系列**（Meta开源）  
    - **Gemini**（谷歌多模态模型）  

2. **MOE（Mixture of Experts）架构**  
   - **核心特点**：  
     - 通过稀疏门控机制动态选择专家网络（Experts），显著扩展参数规模并降低计算成本。  
     - 适用于超大规模模型训练，兼顾效率与性能。  
   - **代表模型**：  
     - **Switch Transformer**（谷歌）  
     - **DeepSeek系列**（采用混合专家架构）  
     - **天工3.0**（昆仑万维）  

3. **Decoder-Only架构**  
   - **核心特点**：  
     - 仅包含Transformer的解码器部分，单向生成能力突出，适合文本续写与对话。  
     - 训练目标明确（预测下一个词），收敛速度快。  
   - **代表模型**：  
     - **GPT系列**（GPT-3、GPT-3.5、GPT-4）  
     - **LLaMA系列**（Meta）  
     - **通义千问（Qwen）**（阿里云）  
     - **百川系列**（Baichuan）  

这些架构就像不同内核的操作系统一样，实现方式和设计虽然不同，但向上抽象和分层解耦的思想未曾改变。

我们最终使用到的，比如`豆包`、`Qwen-Chat`、`元宝`等产品，就像是操作系统的图形化用户界面，帮助我们更加便捷的、低成本的使用计算机算力来助力我们的生产生活和学习研究活动。

而在未来，万物互联的场景需求逐渐涌现，AI和`MCP`等桥梁协议与此结合，可能我们的电子设备操作系统真的会变成电影《太空旅客》或者《钢铁侠》中的样子。

::: details 碎片关键词
* 大模型框架
* MCP协议
* 万物互联
:::

### 突破计算机领域

随着AI的发展，人类社会的各行各业将会迎来革命性的变革。原来解决不了的问题，可能被AI解决；原来到不了的地方，可能在AI的加持下可以一探究竟。当人类走向星辰大海，操作系统的思想正在突破计算机领域：

#### 量子计算+：用经典OS思想“驯服”量子比特  
量子计算的核心挑战，在于量子比特的**脆弱性与并行性矛盾**——量子态易受环境干扰（退相干），但又需同时操控海量叠加态。此时，经典操作系统的“资源抽象与管控”思想被创造性迁移：  
- **量子态“内存保护”**：类比传统OS的内存分页机制，量子计算框架（如IBM Qiskit）通过**量子门调度算法**，将高复杂度的量子比特操作，抽象为“量子逻辑门序列”，就像OS把物理内存映射为虚拟地址，让开发者无需关心底层量子态波动，专注算法设计。 
- **“防量子态坍缩”机制**：借鉴OS进程同步原理，引入**量子纠错码（如表面码）** 作为“软件层面的纠错守护”，实时监测量子比特状态，通过反向操作抵消环境干扰，相当于给量子计算加了一层“虚拟内存保护壳”，延长有效计算时间。  

> 典型案例：NASA与D-Wave合作的量子优化项目中，通过定制化Linux内核模块，将量子退火机的资源调度，与地面服务器集群的经典计算任务协同，用OS级的任务优先级策略，解决了卫星轨道规划中“万亿级变量并行求解”难题，计算效率较纯经典算法提升300倍。  

#### 脑机接口+：神经信号的“操作系统式”管理  
脑机接口（BCI）的本质，是**生物电→数字信号**的翻译与调度，而这一过程与操作系统`硬件驱动`+`资源分配`逻辑高度契合：  
- **神经信号“抽象层”**：类似OS将物理硬件操作标准化，BCI系统通过**深度学习模型（如卷积神经网络）** ，把杂乱的脑电信号（EEG）转化为“标准化指令集”——比如将运动皮层的电活动，映射为“抬手/抓取”等离散操作码，让外部设备（如机械臂）能像调用系统API一样，解析人类意图。  
- **生物兼容性“资源调度”**：借鉴OS的“负载均衡”思想，脑机接口需要动态平衡**信号采集精度**与**生物安全阈值** ——长时间采集高分辨率神经信号，可能引发头皮刺激或神经疲劳，因此通过Linux实时内核（RT-Linux）的任务调度机制，可按“用户需求优先级”动态分配采样频率：医疗康复场景下优先保障精度（高频采集），日常交互场景则降低频率（节能+安全）。  

> 落地场景：Neuralink的临床实验中，通过定制Linux驱动程序，实现了“脑电信号采集→AI解析→机械臂控制”的全流程低延迟调度（延迟<20ms ），其底层逻辑与操作系统“硬件驱动→内核调度→应用层响应”的分层架构完全一致，证明OS思想可突破传统计算机边界，成为人体-机器交互的数字桥梁。  


#### 太空殖民+：火星基地的“操作系统式生存”  
在火星极端环境下，“让设备协同运行、资源高效流转”的需求，本质是一场**太空级的操作系统实践** ，Linux等开源系统的模块化、可定制性优势被放大：  
- **火星OS“微内核”设计**：NASA的火星车控制系统（如Perseverance），基于Linux内核构建**分层任务调度框架** ——28分钟通信延迟（地球-火星往返）下，火星车需自主决策**采样→存储→回传**等任务优先级，类似OS的“异步I/O+后台进程”机制，保障在通信中断时仍能执行关键任务。  
- **“核电资源”的进程级调度**：火星基地能源有限（太阳能+核电池），设备功耗需像OS进程一样被精细管控——通过Linux的**cgroups（控制组）** 技术，给“生命维持系统”分配最高功耗优先级，“科学探测设备”按任务紧急程度动态调整算力，甚至支持**设备休眠→唤醒**的进程级节能策略，让有限能源支撑更久生存周期。  

> 延伸思考：未来月球基地的**地-月-火星**跨天体网络，本质是一个**分布式操作系统集群** ——地球控制中心是**主节点**，月球/火星基地是**边缘计算节点**，通过Linux的分布式文件系统（如Ceph）和容器编排技术（Kubernetes），实现跨天体的资源调度与任务协同，这与数据中心的**云-边-端**协同逻辑同源，再次验证操作系统思想的普适性。  

**结语**：  
操作系统的终极形态可能消失在具体代码中，但其`分层抽象`-`资源隔离`-`标准化接口`的思想，正在成为人类应对复杂系统的**基础思维模型**。从打孔纸到现代操作系统再到未来的AI和其他领域系统，这个诞生于计算机实验室的智慧，正在重塑我们理解世界的维度。

下次当你滑动手机屏幕时，请想象背后那个隐形指挥家——它正在用精密的抽象魔法，将冰冷的硬件指令转化为温暖的数字体验。而这种化繁为简的智慧，或许正是人类在浩瀚科技宇宙中导航的终极罗盘。